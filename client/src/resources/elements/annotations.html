<template>

    <require from='library-aurelia/src/resources/value-converters/format-date'></require>
    <require from='library-aurelia/src/resources/value-converters/filter'></require>
    <require from='library-aurelia/src/resources/elements/au-form/au-form'></require>
    <require from="library-aurelia/src/resources/attributes/bs-popover"></require>
    <require from="resources/elements/user-popover"></require>
    <require from="./annotations.scss"></require>

    <div class="d-flex flex-column h-100 overflow-auto border-start">
        <div class="flex-fill overflow-auto au-stagger"
             ref="annotationsContainer">
            <div class="annotation d-flex flex-row p-3 border-bottom au-animate animate-fade-out"
                 repeat.for="annotation of annotations | filter:{refId: refId}">
                <div with.bind="getUser(annotation.owner[0])"
                     class="creator"
                     class.bind="$this.status === 'online' ? 'border-success' : ''"
                     bs-popover="event.bind: 'user-popover-' + $this.id;
                                 view.bind: 'resources/elements/user-popover';
                                 trigger.bind: 'hover';
                                 model.bind: {user: $this}">
                    <div class="creator-inner">${getAbbreviation($this)}</div>
                </div>
                <div class="ms-3 flex-fill">
                    <div if.bind="annotation.text">${annotation.text}</div>
                    <img if.bind="annotation.kind === 'AnnotationImage' && annotation.data"
                         src.bind="baseUrl + '/' + annotation.data" class="mw-100 my-2">
                    <audio if.bind="annotation.kind === 'AnnotationAudio' && annotation.data"
                           src.bind="baseUrl + '/' + annotation.data" controls>
                        ${'alerts.general.audioElementNotSupported' | t}
                    </audio>
                    <div class="text-muted">${annotation.createdAt | formatDate:'f':i18n.getLocale()}</div>
                </div>
                <button class="btn btn-link tool"
                        click.delegate="deleteAnnotation(annotation)">
                    <i class="bi-trash"></i>
                </button>
            </div>
        </div>
        <au-form if.bind="annotationObject"
                 class="mx-3 border-top"
                 type.bind="'annotation'"
                 object-data.bind="annotationObject"
                 form-type.bind="'create'">
        </au-form>
        <div class="d-flex flex-row p-3 border-top justify-content-center">
            <button class="btn ${annotationObject.kind === 'AnnotationText' ? 'active' : ''}"
                    click.delegate="createAnnotation('AnnotationText')">
                <i class="bi-chat"></i>
            </button>
            <button class="btn ${annotationObject.kind === 'AnnotationImage' ? 'active' : ''}"
                    click.delegate="createAnnotation('AnnotationImage')">
                <i class="bi-image"></i>
            </button>
            <button class="btn ${annotationObject.kind === 'AnnotationAudio' ? 'active' : ''}"
                    click.delegate="createAnnotation('AnnotationAudio')">
                <i class="bi-mic"></i>
            </button>
        </div>
    </div>

</template>
