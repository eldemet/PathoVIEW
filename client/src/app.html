<template>

    <require from="app.scss"></require>
    <require from="library-aurelia/src/resources/elements/nav-bar"></require>
    <require from="library-aurelia/src/resources/elements/toolbar/toolbar"></require>
    <require from="library-aurelia/src/resources/elements/toast"></require>
    <require from="library-aurelia/src/resources/value-converters/format-number"></require>
    <require from="leaflet/dist/leaflet.css"></require>
    <require from="resources/elements/alert-flexible"></require>

    <nav-bar class="bg-body-tertiary rounded mb-1"
             display-dark-mode-switch.bind="true"
             display-is-navigating.bind="true"
             brand.bind="{iconSource: 'assets/icon-pathocert.png'}">

        <div class="dropdown" if.bind="!authService.userInfo.locale">
            <button class="btn btn-link nav-link  py-2 px-0 px-lg-2 dropdown-toggle" type="button" id="language-menu"
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-translate"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="language-menu">
                <li repeat.for="language of languages"
                    if.bind="language.value !== i18n.getLocale()">
                    <button class="dropdown-item"
                            click.trigger="changeLanguage(language.value)">
                        ${language.name}
                    </button>
                </li>
            </ul>
        </div>

        <div class="dropdown" if.bind="contextService.emergencyEvents">
            <button class="btn btn-link nav-link  py-2 px-0 px-lg-2 dropdown-toggle" type="button" id="emergency-menu"
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-hospital-fill"></i>
                <span if.bind="contextService.currentEmergencyEvent">${contextService.currentEmergencyEvent.name}</span>
                <span else>${'alerts.noEmergencyEventSelected' | t}</span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="language-menu">
                <li repeat.for="emergencyEvent of contextService.emergencyEvents">
                    <button class="dropdown-item ${contextService.currentEmergencyEvent === emergencyEvent ? 'active' : ''}"
                            click.trigger="contextService.changeEmergencyEvent(emergencyEvent)">
                        ${emergencyEvent.name}
                    </button>
                </li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <button class="dropdown-item"
                            click.trigger="openCreateModal('emergencyEvent')">
                        <i class="bi bi-plus"></i> ${'views.create' | t:{'type': 'model.emergencyEvent'}}
                    </button>
                </li>
            </ul>
        </div>

        <div class="dropdown">
            <button class="btn btn-link nav-link  py-2 px-0 px-lg-2 dropdown-toggle" type="button" id="devices-menu"
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i if.bind="contextService.currentDevice"
                   class="${deviceUtilities.getDeviceIcon(contextService.currentDevice)}"></i>
                <i else class="bi bi-question-circle-fill"></i>
            </button>
            <ul class="dropdown-menu" aria-labelledby="devices-menu">
                <li repeat.for="device of contextService.devices">
                    <button class="dropdown-item ${device === contextService.currentDevice ? 'active' : ''}"
                            click.trigger="contextService.currentDevice = device">
                        <i class="${deviceUtilities.getDeviceIcon(device)}"></i> ${device.name}
                    </button>
                </li>
                <li if.bind="contextService.currentDevice">
                    <hr class="dropdown-divider">
                </li>
                <li>
                    <button class="dropdown-item"
                            click.trigger="openCreateModal('device')">
                        <i class="bi bi-plus"></i> ${'views.create' | t:{'type': 'model.device'}}
                    </button>
                </li>
            </ul>
        </div>

        <div class="dropdown"
             if.bind="authService.userInfo">
            <button class="btn btn-link nav-link  py-2 px-0 px-lg-2 dropdown-toggle" type="button" id="profile-menu"
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-person-circle"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="language-menu">
                <li class="px-3">
                    <span class="d-block text-muted">${authService.userInfo.name}</span>
                    <span class="d-block text-muted">${authService.userInfo.preferred_username}</span>
                    <span class="d-block text-muted" if.bind="authService.userInfo.email">${authService.userInfo.email}</span>
                    <span class="d-block text-muted">${'buttons.logoutIn' | t} ${authService.getTokenExpiresIn() | formatNumber:'00:00:00' & signal:'update-logout-in'}</span>
                </li>
                <li>
                    <a class="dropdown-item"
                       href.bind="authService.keycloak.createAccountUrl({redirectUri: window.environment.keycloak.url})"
                       target="_blank">
                        ${'buttons.userManagement' | t}
                    </a>
                </li>
                <li>
                    <button class="dropdown-item"
                            click.trigger="authService.close()">
                        ${'buttons.logout' | t}
                    </button>
                </li>
            </ul>
        </div>
    </nav-bar>

    <toast event="toast" position-class="bottom-0 start-50 translate-middle-x mb-5"></toast>
    <alert-flexible event="app-alert"></alert-flexible>

    <router-view class="overflow-auto rounded bg-body"></router-view>

</template>
