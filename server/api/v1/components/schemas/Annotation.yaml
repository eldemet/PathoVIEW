db:options:
  timestamps: true
db:referencedByModels:
  - model: Annotation
    property: refId
    handling: deleteObject
discriminator:
  propertyName: kind
  baseSchema:
    type: object
    required:
      - kind
      - owner
    model:searchProperties:
      - creator
    model:defaultProperty: kind
    ui:sortProperty: '!createdAt'
    properties:
      id:
        $ref: './../$defs.yaml#/NGSIentityFormat'
        description: 'Unique identifier of the entity'
        default: Annotation:00000
        ui:hide:
          table: true
          form: true
          info: true
      type:
        const: Annotation
        ui:hide:
          table: true
          form: true
          info: true
      kind:
        type: string
        enum:
          - AnnotationAudio
          - AnnotationImage
          - AnnotationText
      owner:
        $ref: './../$defs.yaml#/owner'
      source:
        $ref: './../$defs.yaml#/NGSIentityFormat'
        ui:dependence:
          source: localStorage
          property: emergency-event
        ui:hide:
          table: true
          form: true
          info: true
      refId:
        type: string
        db:ref: Mission
        ui:formItemType: select
        ui:detailCustomCompose: 'resources/elements/custom-detail-properties/custom-detail-property-ref'
        ui:hide:
          form: true
          table: true
      createdAt:
        type: string
        format: date-time
        ui:hide:
          form: true
        db:skipInSchemaDefinition: true
      updatedAt:
        type: string
        format: date-time
        ui:hide:
          form: true
          table: true
          info: true
        db:skipInSchemaDefinition: true
oneOf:
  - allOf:
      - $ref: '#/discriminator/baseSchema'
      - type: object
        title: model.annotationText
        required:
          - text
        model:searchProperties:
          - text
        properties:
          kind:
            const: AnnotationText
            ui:hide:
              form: true
          text:
            type: string
            ui:noLabel: true
            ui:formItemType: textarea
  - allOf:
      - $ref: '#/discriminator/baseSchema'
      - type: object
        title: model.annotationImage
        db:dataUrlToFileProperties:
          - data
        required:
          - data
        properties:
          kind:
            const: AnnotationImage
            ui:hide:
              form: true
          data:
            type: string
            ui:noLabel: true
            ui:formItemCustomCompose: 'resources/elements/custom-form-items/custom-form-item-image'
            ui:detailCustomCompose: 'resources/elements/custom-detail-properties/custom-detail-property-image'
  - allOf:
      - $ref: '#/discriminator/baseSchema'
      - type: object
        title: model.annotationAudio
        db:dataUrlToFileProperties:
          - data
        required:
          - data
        properties:
          kind:
            const: AnnotationAudio
            ui:hide:
              form: true
          data:
            type: string
            ui:formItemType: file
            ui:accept: 'audio/*'
            ui:capture: 'user'
